## ✅ ERD란?

- **ERD (Entity Relationship Diagram)**: 데이터베이스 테이블 간의 관계를 시각적으로 표현한 다이어그램
- 데이터 구조를 한눈에 파악할 수 있으며, 백엔드 설계와 ORM 매핑에 유용함

---

### 📌 연관 관계 개념 (JPA 기준)

### 🔹 방향 (Direction)

- **단방향**: 참조용 필드가 한쪽에만 있음 (`Member -> Team`)
- **양방향**: 양쪽에서 참조 가능 (`Member <-> Team`)
    - 양방향 관계에서는 **연관 관계 주인**을 설정해야 함 (`mappedBy` 사용)

### 🔹 연관 관계 주인

- 외래키가 존재하는 테이블이 연관 관계의 주인
- 주인만 외래 키를 직접 수정할 수 있으며, 비주인은 읽기 전용
- `mappedBy`는 주인이 아닌 쪽에서 설정

### 🔹 다중성 (Multiplicity)

- `@OneToOne`: 일대일
- `@OneToMany`, `@ManyToOne`: 일대다, 다대일
- `@ManyToMany`: 다대다 (→ 중간 테이블 필요)

### 🔹 다대다 관계 처리

- 관계형 DB는 다대다를 직접 표현하지 못함
- 반드시 **중간 테이블**을 생성하여 `1:N`, `N:1`로 변환

---

### 📌 Fetch Type (로딩 전략)

- **LAZY (지연 로딩)**: 실제 사용 시 연관 객체 조회 (기본값, 성능 유리)
- **EAGER (즉시 로딩)**: 조회 시 연관 객체도 함께 조회 (쿼리 과다 가능)

---

### 📌 Cascade (영속성 전이)

- 부모 엔티티의 작업이 자식 엔티티에도 적용되도록 설정
- 종류: `ALL`, `PERSIST`, `MERGE`, `REMOVE`, `REFRESH`, `DETACH`

#### 🔸 orphanRemoval

- 부모와 연관이 끊긴 자식 엔티티를 자동으로 삭제
- 설정하지 않으면 고아 객체가 DB에 남을 수 있음

---

## ❗ ERD 작성 시 주의해야 할 제약 조건

1. **기본 키(Primary Key) 설정**
    - 모든 테이블은 중복되지 않는 기본 키를 가져야 함
    - 데이터 식별을 위한 핵심

2. **외래 키(Foreign Key) 설정**
    - 참조하는 테이블의 기본 키를 외래 키로 설정
    - 무결성 보장을 위해 ON DELETE/UPDATE 옵션도 고려

3. **관계형 무결성 유지**
    - 부모 테이블이 삭제될 때 자식의 처리 방식 정의 필요
    - `CASCADE`, `SET NULL`, `RESTRICT` 등 설정 주의

4. **다대다(N:M) 관계 직접 사용 금지**
    - 반드시 **중간 테이블**을 생성해 `1:N`, `N:1`로 구성해야 함

5. **정규화(Normalization) 준수**
    - 데이터 중복을 최소화하고 구조를 명확하게 유지
    - 최소 3NF(제3정규형)까지 적용 권장

6. **데이터 타입 일치**
    - 외래 키는 참조 대상의 기본 키와 **데이터 타입이 같아야 함**

7. **연관 관계 명확화**
    - 테이블 간 관계가 일대일/다대일 등 명확하게 식별되도록 설계
    - 혼동되는 다중 참조는 피하고 별도 관계 테이블로 분리

8. **제약 조건 이름 지정**
    - 제약 조건에 이름을 명시적으로 부여하면 유지보수에 유리 (`FK_user_post`, `PK_user_id` 등)

---